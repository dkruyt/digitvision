<!DOCTYPE html>
<html>
<head>
    <title>DigitVision</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .canvas-container {
            border: 1px solid #dee2e6;
            display: inline-block;
            margin-bottom: 20px;
            border-radius: 5px;
            overflow: hidden;
        }
        .neuron {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            margin: 5px;
            font-size: 10px;
            color: white;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
            cursor: pointer; /* Added cursor pointer */
        }
        .neuron-container {
            display: inline-block;
            text-align: center;
            margin: 1px; /* Adjust margin as needed */
        }
        .neuron-number {
            margin-bottom: 5px;
            font-size: 26px; /* Adjust font size as needed */
            color: #343a40; /* Adjust the color to match your design */
        }
        h1, h2 {
            color: #343a40;
        }
        .btn-primary, .btn-secondary, .btn-info, .btn-success, .btn-danger {
            margin-right: 10px;
            margin-bottom: 10px;
        }
        #result {
            font-size: 1.5rem;
            font-weight: bold;
            color: #28a745;
        }
        #trainingData img {
            margin: 1px;
            cursor: pointer;
            border: 1px solid #dee2e6;
            border-radius: 3px;
        }
        #logWindow {
            height: 160px;
            overflow-y: scroll;
            border: 1px solid #dee2e6;
            padding: 10px;
            background-color: #ffffff;
            margin-top: 20px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container my-4 text-center">
        <h1 class="text-center">DigitVision</h1>
        <div class="row">
            <div class="col-md-6 text-center">
                <h2>Input Layer</h2>
                <div class="canvas-container mx-auto">
                    <canvas id="inputCanvas" width="200" height="200"></canvas>
                </div>
                <h2>↓</h2>
                <div class="canvas-container mx-auto">
                    <canvas id="extendedLineCanvas" width="320" height="10"></canvas>
                </div>
                <h2>↓ Hidden Layer ↓</h2>
                <div id="hiddenLayer" class="neuron-container mx-auto"></div>
                <h2>↓ Output Layer ↓</h2>
                <div id="outputLayer" class="neuron-container mx-auto"></div>
            </div>
            <div class="col-md-6">
                <h2>Dashboard</h2>
                <div class="mb-3">
                    <button id="predictButton" class="btn btn-primary">Predict</button>
                    <button id="clearButton" class="btn btn-secondary">Clear</button>
                    <button id="prepareButton" class="btn btn-info">Load Data</button>
                    <button id="train1Button" class="btn btn-success">Train 1x</button>
                    <button id="train10Button" class="btn btn-success">Train 10x</button>
                    <button id="train100Button" class="btn btn-success">Train 100x</button>
                    <button id="clearModelButton" class="btn btn-danger">Clear network</button>
                    <button id="helpButton" class="btn btn-info">Help</button>
                    <button id="graphsButton" class="btn btn-info">Graphs</button>
                </div>
                <div id="result" class="mt-3"></div>
                <div id="logWindow" class="mt-3"></div>
                <h2>Training Data</h2>
                <div id="trainingData" class="d-flex flex-wrap"></div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" role="dialog" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel">Help</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h4>Welcome to DigitVision!</h4>
                    <p>DigitVision is an interactive web application that allows you to explore and understand how a neural network recognizes handwritten digits. Follow the steps below to get started:</p>
                    <ol>
                        <li>
                            <strong>Load Training Data:</strong> Click the "Load Data" button to load the training data. This data consists of a collection of handwritten digits that will be used to train the neural network. The loaded training images will be displayed in the "Training Data" section.
                            <br><small>Behind the scenes, the app preprocesses the Optical Recognition of Handwritten Digits dataset, normalizing pixel values and limiting the number of samples per digit class to ensure a balanced dataset.</small>
                        </li>
                        <li>
                            <strong>Explore the Neural Network:</strong> Take a moment to familiarize yourself with the neural network architecture displayed on the left side of the screen. The input layer represents an 8x8 grid where you can draw a digit, the hidden layer consists of neurons that learn to recognize patterns, and the output layer represents the predicted digit.
                            <br><small>The neural network is defined using PyTorch, with a configurable number of hidden neurons and output classes. The app uses the ReLU activation function and CrossEntropyLoss for training.</small>
                        </li>
                        <li>
                            <strong>Draw a Digit:</strong> Use your mouse to draw a digit on the input layer grid. Click on individual cells to toggle them between black and white. The goal is to draw a recognizable digit that the neural network can predict.
                        </li>
                        <li>
                            <strong>Make a Prediction:</strong> Once you've drawn a digit, click the "Predict" button to see what the neural network thinks the digit is. The predicted digit will be displayed in the "Dashboard" section.
                            <br><small>When you click "Predict," the app sends the drawn digit to the server, where it is preprocessed and fed through the neural network. The activations of the hidden and output layers are computed, and the predicted digit is determined based on the highest output activation.</small>
                        </li>
                        <li>
                            <strong>Train the Neural Network:</strong> To improve the neural network's accuracy, you can train it using the loaded training data. Click the "Train 1x," "Train 10x," or "Train 100x" buttons to train the network for the specified number of epochs. During training, the app will display the training progress and metrics in the log window.
                            <br><small>The training process involves iterating over the training data, feeding it through the neural network, computing the loss, and updating the network's weights using backpropagation. The app uses the Adam optimizer and logs the training metrics for each epoch.</small>
                        </li>
                        <li>
                            <strong>Evaluate the Neural Network:</strong> After training, you can draw more digits and click "Predict" to see how well the neural network performs. The app will display the predicted digit and the activations of the hidden and output layers.
                        </li>
                        <li>
                            <strong>Explore Further:</strong>
                            <ul>
                                <li>Click on the neurons in the output layer to see how the neural network responds when you manually assign a label to your drawn digit. This can help you understand how the network learns from individual examples.</li>
                                <li>Use the "Clear" button to clear the input layer grid and start drawing a new digit.</li>
                                <li>Click the "Clear Model Data" button to reset the neural network to its initial state, clearing all learned weights.</li>
                                <li>Explore the "Graphs" section to visualize the training and validation metrics, including loss and accuracy over epochs.</li>
                            </ul>
                        </li>
                    </ol>
                    <p>Have fun exploring and learning about neural networks and handwritten digit recognition with DigitVision!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Graphs Modal -->
    <div class="modal fade" id="graphsModal" tabindex="-1" role="dialog" aria-labelledby="graphsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="graphsModalLabel">Training and Validation Metrics</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h3>Training Loss</h3>
                            <canvas id="trainingLossChart"></canvas>
                        </div>
                        <div class="col-md-6">
                            <h3>Validation Loss</h3>
                            <canvas id="validationLossChart"></canvas>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <h3>Training Accuracy</h3>
                            <canvas id="trainingAccuracyChart"></canvas>
                        </div>
                        <div class="col-md-6">
                            <h3>Validation Accuracy</h3>
                            <canvas id="validationAccuracyChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="/static/index.js"></script>
</body>
</html>
